# US-05: Hiển thị mặc thử sản phẩm đầu tiên khi vào phòng thử đồ

## Bối cảnh
- Epic: Phòng thử đồ (Virtual Fitting Room).
- Vai trò: Người mua (User đã đăng nhập và có ảnh toàn thân).
- Mục tiêu: Ngay khi bước vào giao diện thử đồ, người dùng thấy ngay hình ảnh chính mình đang mặc sản phẩm nổi bật nhất (đầu tiên) của danh mục để tạo ấn tượng "Wow" ngay lập tức.

## Phạm vi
- Truy cập trang phòng thử đồ (`/fitting-room`).
- Tự động tải danh sách sản phẩm theo danh mục mặc định.
- Tự động thực hiện quy trình "Try-on" cho sản phẩm đầu tiên (Check cache hoặc Gọi AI).
- Hiển thị ảnh kết quả (User + Áo) lên màn hình chính.
- Yêu cầu tiên quyết: User phải có ảnh toàn thân trong hồ sơ (US-02).

## Luồng chính (happy path)
- User đăng nhập và truy cập menu "Phòng thử đồ".
- Hệ thống kiểm tra User đã có ảnh `body_image_url` chưa? (Nếu có -> Tiếp tục).
- Client gọi API lấy danh sách sản phẩm (ví dụ: Danh mục "Áo thun").
- Client tự động chọn sản phẩm đầu tiên trong danh sách.
- Client gọi API `POST /api/try-on` với ID sản phẩm đó.
- Server kiểm tra DB `try_on_results`:
    - Nếu đã có ảnh: Trả về URL ngay.
    - Nếu chưa có: Gọi AI Service ghép ảnh User + Ảnh áo -> Lưu DB -> Trả về URL.
- UI hiển thị ảnh kết quả lên khung hình chính.

## Luồng lỗi cần xử lý
- User chưa có ảnh toàn thân: Hiển thị Popup/Modal thông báo "Bạn cần cập nhật ảnh toàn thân để sử dụng tính năng này" -> Nút điều hướng sang trang Profile (US-02).
- Danh mục không có sản phẩm nào: Hiển thị thông báo "Chưa có sản phẩm trong danh mục này".
- Lỗi AI Service (Timeout/Error): Hiển thị thông báo "Hệ thống đang bận" và hiển thị ảnh gốc của User kèm ảnh sản phẩm bên cạnh (fallback mode).

## Dữ liệu & validate gợi ý
- Input: `product_id` (lấy từ list sản phẩm), `user_id` (từ token).
- Output: `generated_image_url` (Link ảnh kết quả).
- Timeout: Cần thiết lập timeout cho API request (ví dụ 30s) vì AI xử lý lâu.

## Acceptance Criteria
- User vào trang thấy ngay quá trình loading hoặc ảnh kết quả (không cần thao tác thêm).
- Ảnh hiển thị phải là ảnh ghép (User mặc đồ), không phải ảnh mẫu của shop.
- Nếu User chưa có ảnh profile, hệ thống chặn và hướng dẫn rõ ràng.
- Hiển thị đúng thông tin tên và giá của sản phẩm đang mặc.

## Phi chức năng
- Performance: Ưu tiên hiển thị Skeleton/Loading animation mượt mà vì thời gian chờ AI có thể mất 5-10s.
- UX: Không để màn hình trắng (blank screen) trong lúc chờ API.
