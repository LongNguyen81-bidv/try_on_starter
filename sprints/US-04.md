# US-04: Quản lý sản phẩm (Thêm/Sửa/Xóa và Upload ảnh)

## Bối cảnh
- Epic: Quản lý kho hàng.
- Vai trò: Admin (Quản trị viên).
- Mục tiêu: Quản lý thông tin sản phẩm và tải lên hình ảnh "trải phẳng" (flat lay) để hiển thị cho khách hàng và phục vụ tính năng thử đồ AI.

## Phạm vi
- Xem danh sách sản phẩm (có hiển thị ảnh thumbnail, giá, danh mục).
- Thêm mới sản phẩm: Tên, Giá, chọn Danh mục, Upload ảnh flat-lay.
- Cập nhật thông tin và thay đổi ảnh sản phẩm.
- Xóa sản phẩm (đồng thời xóa ảnh trong Storage).
- Tích hợp Supabase Storage để lưu trữ ảnh.

## Luồng chính (happy path)
- Admin vào trang Quản lý sản phẩm → Bấm "Thêm sản phẩm".
- Admin nhập thông tin (Tên, Giá), chọn Danh mục từ dropdown.
- Admin chọn file ảnh từ máy (ảnh quần áo trải nền trơn) → client hiển thị preview.
- Bấm Lưu → Client upload ảnh lên Storage → Lấy URL ảnh → Client gửi dữ liệu (Info + Image URL) về API → Server lưu vào DB → Thông báo thành công.
- Xóa: Admin bấm xóa → Server xóa record trong DB và trigger/gọi lệnh xóa file ảnh trong Storage.

## Luồng lỗi cần xử lý
- Không có quyền Admin → chặn truy cập (403 Forbidden).
- Dữ liệu không hợp lệ: Giá âm, Tên để trống, Chưa chọn danh mục.
- File ảnh không hợp lệ: Sai định dạng (không phải ảnh), dung lượng quá lớn (>5MB).
- Lỗi upload: Mất mạng khi đang upload ảnh hoặc lỗi từ Storage service.
- Xóa thất bại: Lỗi server hoặc DB.

## Dữ liệu & validate gợi ý
- Tên sản phẩm: Text, bắt buộc.
- Giá: Number, >= 0, đơn vị VNĐ.
- Danh mục: ID hợp lệ từ bảng Categories.
- Ảnh sản phẩm: Bắt buộc 1 ảnh. Định dạng jpg/png/jpeg. Khuyến nghị ảnh nền trơn/trong suốt (flat lay) để AI xử lý tốt nhất.
- Mô tả: Text (tùy chọn).

## Acceptance Criteria
- Admin thêm được sản phẩm mới kèm ảnh.
- Ảnh được lưu trữ trên Storage (ví dụ: Supabase Storage), URL lưu trong DB chính xác.
- Danh sách sản phẩm hiển thị đúng ảnh thumbnail, tên, giá và danh mục.
- Chức năng lọc sản phẩm theo danh mục hoạt động đúng.
- Khi xóa sản phẩm, ảnh tương ứng trong Storage cũng phải được xóa (để tránh rác bộ nhớ).
- Form validation hoạt động tốt (bắt lỗi giá âm, thiếu ảnh).

## Phi chức năng
- Tối ưu hiển thị ảnh: Sử dụng kích thước thumbnail phù hợp ở danh sách để tải nhanh.
- UX Upload: Có thanh tiến trình (progress bar) hoặc loading spinner khi đang upload ảnh.
- Bảo mật: Storage bucket cấu hình đúng quyền (Authenticated Admin write, Public read).